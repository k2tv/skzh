###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.1.10194/W32 for 8051         06/Jun/2012  13:34:27 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zstack\ #
#                          ZNP\Source\znp_app.c                               #
#    Command line       =  -f E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zsta #
#                          ck\ZNP\CC253x\..\Source\znp.cfg                    #
#                          (-DMAC_CFG_APP_PENDING_QUEUE=TRUE                  #
#                          "-DZSTACK_DEVICE_BUILD=(DEVICE_BUILD_COORDINATOR   #
#                          | DEVICE_BUILD_ROUTER | DEVICE_BUILD_ENDDEVICE)"   #
#                          -DNWK_AUTO_POLL -DZNP_RUN_WDOG=FALSE               #
#                          -DZNP_UART_BAUD=HAL_UART_BR_115200 -DZIGBEEPRO     #
#                          -DZIGBEE_FRAGMENTATION -DINTER_PAN -DOSAL_CLOCK    #
#                          -DOSAL_SAPI=FALSE -DSAPI_CB_FUNC=FALSE             #
#                          -DHOLD_AUTO_START -DNV_RESTORE -DNV_INIT           #
#                          -DNUM_DISC_ATTEMPTS=0 -DMT_UTIL_FUNC               #
#                          -DMT_SYS_FUNC -DMT_AF_FUNC -DMT_SAPI_FUNC          #
#                          -DMT_SAPI_CB_FUNC -DMT_ZDO_CB_FUNC -DMT_ZDO_FUNC   #
#                          -DMT_ZDO_MGMT -DMT_APP_FUNC) -f                    #
#                          E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zstack\ #
#                          ZNP\CC253x\..\..\Tools\CC2530DB\f8wConfig.cfg      #
#                          (-DZIGBEEPRO -DSECURE=0 -DZG_SECURE_DYNAMIC=0      #
#                          -DREFLECTOR -DDEFAULT_CHANLIST=0x00000800          #
#                          -DZDAPP_CONFIG_PAN_ID=0x1235                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100    #
#                          -DREJOIN_POLL_RATE=440) -f                         #
#                          E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zstack\ #
#                          ZNP\CC253x\..\..\Tools\CC2530DB\f8wZCL.cfg         #
#                          (-DZCL_READ -DZCL_WRITE -DZCL_BASIC                #
#                          -DZCL_IDENTIFY -DZCL_ON_OFF -DZCL_KEY_ESTABLISH    #
#                          -DZCL_KEY_ESTABLISHMENT_KEY_GENERATE_TIMEOUT=4     #
#                          -DZCL_KEY_ESTABLISHMENT_MAC_GENERATE_TIMEOUT=10    #
#                          -DZCL_KEY_ESTABLISHMENT_EKEY_GENERATE_TIMEOUT=10   #
#                          -DZCL_LOAD_CONTROL -DZCL_SIMPLE_METERING           #
#                          -DZCL_PRICING -DZCL_MESSAGE -DZCL_TUNNELING        #
#                          -DZCL_TOU) -DZCL_DEVICE_MGMT                       #
#                          E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zstack\ #
#                          ZNP\Source\znp_app.c -D POWER_SAVING -lC           #
#                          E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zstack\ #
#                          ZNP\CC253x\CC2530-Debug\List\ -lA                  #
#                          E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zstack\ #
#                          ZNP\CC253x\CC2530-Debug\List\ --diag_suppress      #
#                          Pe001,Pa010 -o E:\ChinaSoft\ZStack-CC2530-2.5.1a\P #
#                          rojects\zstack\ZNP\CC253x\CC2530-Debug\Obj\ -e     #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zsta #
#                          ck\ZNP\CC253x\ -I E:\ChinaSoft\ZStack-CC2530-2.5.1 #
#                          a\Projects\zstack\ZNP\CC253x\Source\ -I            #
#                          E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zstack\ #
#                          ZNP\CC253x\..\Source\ -I                           #
#                          E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zstack\ #
#                          ZNP\CC253x\..\..\SE\Source\ -I                     #
#                          E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zstack\ #
#                          ZNP\CC253x\..\..\ZMain\TI2530ZNP\ -I               #
#                          E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zstack\ #
#                          ZNP\CC253x\..\..\..\..\Components\hal\include\ -I  #
#                          E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zstack\ #
#                          ZNP\CC253x\..\..\..\..\Components\hal\target\CC253 #
#                          0ZNP\ -I E:\ChinaSoft\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\ZNP\CC253x\..\..\..\..\Components\mac\inc #
#                          lude\ -I E:\ChinaSoft\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\ZNP\CC253x\..\..\..\..\Components\mac\hig #
#                          h_level\ -I E:\ChinaSoft\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\ZNP\CC253x\..\..\..\..\Components\mac\ #
#                          low_level\srf04\ -I E:\ChinaSoft\ZStack-CC2530-2.5 #
#                          .1a\Projects\zstack\ZNP\CC253x\..\..\..\..\Compone #
#                          nts\mac\low_level\srf04\single_chip\ -I            #
#                          E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zstack\ #
#                          ZNP\CC253x\..\..\..\..\Components\mt\ -I           #
#                          E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zstack\ #
#                          ZNP\CC253x\..\..\..\..\Components\osal\include\    #
#                          -I E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zsta #
#                          ck\ZNP\CC253x\..\..\..\..\Components\services\sadd #
#                          r\ -I E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\z #
#                          stack\ZNP\CC253x\..\..\..\..\Components\services\s #
#                          data\ -I E:\ChinaSoft\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\ZNP\CC253x\..\..\..\..\Components\stack\a #
#                          f\ -I E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\z #
#                          stack\ZNP\CC253x\..\..\..\..\Components\stack\nwk\ #
#                           -I E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zst #
#                          ack\ZNP\CC253x\..\..\..\..\Components\stack\sapi\  #
#                          -I E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zsta #
#                          ck\ZNP\CC253x\..\..\..\..\Components\stack\sec\    #
#                          -I E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zsta #
#                          ck\ZNP\CC253x\..\..\..\..\Components\stack\sys\    #
#                          -I E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zsta #
#                          ck\ZNP\CC253x\..\..\..\..\Components\stack\zcl\    #
#                          -I E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zsta #
#                          ck\ZNP\CC253x\..\..\..\..\Components\stack\zdo\    #
#                          -I E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zsta #
#                          ck\ZNP\CC253x\..\..\..\..\Components\zmac\ -I      #
#                          E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zstack\ #
#                          ZNP\CC253x\..\..\..\..\Components\zmac\f8w\ -Ohz   #
#                          --require_prototypes                               #
#    List file          =  E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zstack\ #
#                          ZNP\CC253x\CC2530-Debug\List\znp_app.lst           #
#    Object file        =  E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zstack\ #
#                          ZNP\CC253x\CC2530-Debug\Obj\znp_app.r51            #
#                                                                             #
#                                                                             #
###############################################################################

E:\ChinaSoft\ZStack-CC2530-2.5.1a\Projects\zstack\ZNP\Source\znp_app.c
      1          /**************************************************************************************************
      2            Filename:       znp_app.c
      3            Revised:        $Date: 2011-06-01 14:52:32 -0700 (Wed, 01 Jun 2011) $
      4            Revision:       $Revision: 26173 $
      5          
      6            Description:    This file is the Application implementation for the ZNP.
      7          
      8          
      9            Copyright 2009-2011 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /* ------------------------------------------------------------------------------------------------
     41           *                                          Includes
     42           * ------------------------------------------------------------------------------------------------
     43           */
     44          
     45          #include "hal_board_cfg.h"
     46          #include "mac_radio_defs.h"
     47          #include "MT.h"
     48          #include "MT_AF.h"
     49          #include "MT_SYS.h"
     50          #include "MT_ZDO.h"
     51          #include "MT_UART.h"
     52          #include "MT_UTIL.h"
     53          #include "OSAL.h"
     54          #include "OSAL_Nv.h"
     55          #if defined POWER_SAVING || defined CC2531ZNP
     56          #include "OSAL_PwrMgr.h"
     57          #endif
     58          #include "ZComDef.h"
     59          #include "ZMAC.h"
     60          #include "znp_app.h"
     61          #include "znp_spi.h"
     62          
     63          /* ------------------------------------------------------------------------------------------------
     64           *                                           Local Functions
     65           * ------------------------------------------------------------------------------------------------
     66           */
     67          
     68          static void npInit(void);
     69          static void npInitNV(void);
     70          
     71          static void npUartCback(uint8 port, uint8 event);
     72          static void npUartTxReady(void);
     73          static uint8* npMtUartAlloc(uint8 cmd0, uint8 len);
     74          static void npMtUartSend(uint8 *pBuf);
     75          
     76          #if !defined CC2531ZNP
     77          static uint8* npMtSpiAlloc(uint8 cmd0, uint8 len);
     78          static void npMtSpiSend(uint8 *pBuf);
     79          uint8* npSpiPollCallback(void);
     80          bool npSpiReadyCallback(void);
     81          #endif
     82          
     83          /* ------------------------------------------------------------------------------------------------
     84           *                                           Local Variables
     85           * ------------------------------------------------------------------------------------------------
     86           */
     87          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     88          static osal_msg_q_t npTxQueue;
   \                     npTxQueue:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
     89          
     90          /* ------------------------------------------------------------------------------------------------
     91           *                                           Global Variables
     92           * ------------------------------------------------------------------------------------------------
     93           */
     94          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     95          uint8 znpCfg1;
   \                     znpCfg1:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     96          uint8 znpCfg0;
   \                     znpCfg0:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     97          #if defined TC_LINKKEY_JOIN
     98          extern uint8 zcl_TaskID;
     99          extern void zclProcessMessageMSG(afIncomingMSGPacket_t *pkt);
    100          #endif
    101          
    102          /**************************************************************************************************
    103           * @fn          znpInit
    104           *
    105           * @brief       This function is the OSAL task initialization callback.
    106           *
    107           * input parameters
    108           *
    109           * @param taskId - The task ID assigned to this task by the OSAL.
    110           *
    111           * output parameters
    112           *
    113           * None.
    114           *
    115           * @return      None.
    116           **************************************************************************************************
    117           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    118          void znpInit(uint8 taskId)
   \                     znpInit:
    119          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
    120            znpTaskId = taskId;
   \   000006   90....       MOV     DPTR,#MT_TaskID
   \   000009   F0           MOVX    @DPTR,A
    121            osal_set_event(taskId, ZNP_SECONDARY_INIT_EVENT);
   \   00000A                ; Setup parameters for call to function osal_set_event
   \   00000A   7A10         MOV     R2,#0x10
   \   00000C   7B00         MOV     R3,#0x0
   \   00000E   12....       LCALL   ??osal_set_event?relay
    122          }
   \   000011                REQUIRE ?Subroutine0
   \   000011                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    123          
    124          /**************************************************************************************************
    125           * @fn          znpEventLoop
    126           *
    127           * @brief       This function processes the OSAL events and messages for the application.
    128           *
    129           * input parameters
    130           *
    131           * @param taskId - The task ID assigned to this application by OSAL at system initialization.
    132           * @param events - A bit mask of the pending event(s).
    133           *
    134           * output parameters
    135           *
    136           * None.
    137           *
    138           * @return      The events bit map received via parameter with the bits cleared which correspond to
    139           *              the event(s) that were processed on this invocation.
    140           **************************************************************************************************
    141           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    142          uint16 znpEventLoop(uint8 taskId, uint16 events)
   \                     znpEventLoop:
    143          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    144            osal_event_hdr_t  *pMsg;
    145          #if !defined CC2531ZNP
    146            uint8 *pBuf;
    147          #endif
    148          
    149            if (events & SYS_EVENT_MSG)
   \   000009   5480         ANL     A,#0x80
   \   00000B   6057         JZ      ??znpEventLoop_0
    150            {
    151              if ((pMsg = (osal_event_hdr_t *) osal_msg_receive(znpTaskId)) != NULL)
   \   00000D                ; Setup parameters for call to function osal_msg_receive
   \   00000D   90....       MOV     DPTR,#MT_TaskID
   \   000010   E0           MOVX    A,@DPTR
   \   000011   F9           MOV     R1,A
   \   000012   12....       LCALL   ??osal_msg_receive?relay
   \   000015   8A..         MOV     ?V0 + 0,R2
   \   000017   8B..         MOV     ?V0 + 1,R3
   \   000019   EA           MOV     A,R2
   \   00001A   45..         ORL     A,?V0 + 1
   \   00001C   603F         JZ      ??znpEventLoop_1
    152              {
    153                switch (pMsg->event)
   \   00001E   8A82         MOV     DPL,R2
   \   000020   8B83         MOV     DPH,R3
   \   000022   E0           MOVX    A,@DPTR
   \   000023   14           DEC     A
   \   000024   6012         JZ      ??znpEventLoop_2
   \   000026   24E7         ADD     A,#-0x19
   \   000028   601A         JZ      ??znpEventLoop_3
   \   00002A   2449         ADD     A,#0x49
   \   00002C   601B         JZ      ??znpEventLoop_4
   \   00002E   24FE         ADD     A,#-0x2
   \   000030   601C         JZ      ??znpEventLoop_5
   \   000032   24D6         ADD     A,#-0x2a
   \   000034   601D         JZ      ??znpEventLoop_6
   \   000036   801E         SJMP    ??znpEventLoop_7
    154                {
    155                /* incoming message from UART transport */
    156                case CMD_SERIAL_MSG:
    157                  MT_ProcessIncoming(((mtOSALSerialData_t *)pMsg)->msg);
   \                     ??znpEventLoop_2:
   \   000038                ; Setup parameters for call to function MT_ProcessIncoming
   \   000038   A3           INC     DPTR
   \   000039   A3           INC     DPTR
   \   00003A   E0           MOVX    A,@DPTR
   \   00003B   FA           MOV     R2,A
   \   00003C   A3           INC     DPTR
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   FB           MOV     R3,A
   \   00003F   12....       LCALL   ??MT_ProcessIncoming?relay
    158                  break;
   \   000042   8012         SJMP    ??znpEventLoop_7
    159          
    160          #if defined TC_LINKKEY_JOIN
    161          #if defined (MT_UTIL_FUNC)
    162                case ZCL_KEY_ESTABLISH_IND:
    163                  MT_UtilKeyEstablishInd((keyEstablishmentInd_t *)pMsg);
    164                  break;
    165          #endif
    166          #endif
    167          
    168                case AF_INCOMING_MSG_CMD:
    169          #if defined TC_LINKKEY_JOIN
    170                  if (ZCL_KEY_ESTABLISHMENT_ENDPOINT == (((afIncomingMSGPacket_t *)pMsg)->endPoint))
    171                  {
    172                    zclProcessMessageMSG((afIncomingMSGPacket_t *)pMsg);
    173                  }
    174                  else
    175          #endif
    176                  {
    177                    MT_AfIncomingMsg((afIncomingMSGPacket_t *)pMsg);
   \                     ??znpEventLoop_3:
   \   000044                ; Setup parameters for call to function MT_AfIncomingMsg
   \   000044   12....       LCALL   ??MT_AfIncomingMsg?relay
    178                  }
    179                  break;
   \   000047   800D         SJMP    ??znpEventLoop_7
    180          
    181          #ifdef MT_ZDO_FUNC
    182                case ZDO_STATE_CHANGE:
    183                  MT_ZdoStateChangeCB(pMsg);
   \                     ??znpEventLoop_4:
   \   000049                ; Setup parameters for call to function MT_ZdoStateChangeCB
   \   000049   12....       LCALL   ??MT_ZdoStateChangeCB?relay
    184                  break;
   \   00004C   8008         SJMP    ??znpEventLoop_7
    185          
    186                case ZDO_CB_MSG:
    187                  MT_ZdoSendMsgCB((zdoIncomingMsg_t *)pMsg);
   \                     ??znpEventLoop_5:
   \   00004E                ; Setup parameters for call to function MT_ZdoSendMsgCB
   \   00004E   12....       LCALL   ??MT_ZdoSendMsgCB?relay
    188                  break;
   \   000051   8003         SJMP    ??znpEventLoop_7
    189          #endif
    190          
    191                case AF_DATA_CONFIRM_CMD:
    192                  MT_AfDataConfirm((afDataConfirm_t *)pMsg);
   \                     ??znpEventLoop_6:
   \   000053                ; Setup parameters for call to function MT_AfDataConfirm
   \   000053   12....       LCALL   ??MT_AfDataConfirm?relay
    193                  break;
    194          
    195                default:
    196                  break;
    197                }
    198          
    199                osal_msg_deallocate((byte *)pMsg);
   \                     ??znpEventLoop_7:
   \   000056                ; Setup parameters for call to function osal_msg_deallocate
   \   000056   AA..         MOV     R2,?V0 + 0
   \   000058   AB..         MOV     R3,?V0 + 1
   \   00005A   12....       LCALL   ??osal_msg_deallocate?relay
    200              }
    201          
    202              events ^= SYS_EVENT_MSG;
   \                     ??znpEventLoop_1:
   \   00005D   7480         MOV     A,#-0x80
   \                     ??znpEventLoop_8:
   \   00005F   6F           XRL     A,R7
   \   000060   FF           MOV     R7,A
   \   000061   02....       LJMP    ??znpEventLoop_9 & 0xFFFF
    203            }
    204          #if !defined CC2531ZNP
    205            else if (events & ZNP_SPI_RX_AREQ_EVENT)
   \                     ??znpEventLoop_0:
   \   000064   EF           MOV     A,R7
   \   000065   5440         ANL     A,#0x40
   \   000067   6011         JZ      ??znpEventLoop_10
    206            {
    207              if ((pBuf = npSpiGetReqBuf()) != NULL )
   \   000069                ; Setup parameters for call to function npSpiGetReqBuf
   \   000069   12....       LCALL   ??npSpiGetReqBuf?relay
   \   00006C   EA           MOV     A,R2
   \   00006D   4B           ORL     A,R3
   \   00006E   6006         JZ      ??znpEventLoop_11
    208              {
    209                MT_ProcessIncoming(pBuf);
   \   000070                ; Setup parameters for call to function MT_ProcessIncoming
   \   000070   12....       LCALL   ??MT_ProcessIncoming?relay
    210                npSpiAReqComplete();
   \   000073                ; Setup parameters for call to function npSpiAReqComplete
   \   000073   12....       LCALL   ??npSpiAReqComplete?relay
    211              }
    212          
    213              events ^= ZNP_SPI_RX_AREQ_EVENT;
   \                     ??znpEventLoop_11:
   \   000076   7440         MOV     A,#0x40
   \   000078   80E5         SJMP    ??znpEventLoop_8
    214            }
    215            else if (events & ZNP_SPI_RX_SREQ_EVENT)
   \                     ??znpEventLoop_10:
   \   00007A   EF           MOV     A,R7
   \   00007B   5420         ANL     A,#0x20
   \   00007D   600E         JZ      ??znpEventLoop_12
    216            {
    217              if ((pBuf = npSpiGetReqBuf()) != NULL)
   \   00007F                ; Setup parameters for call to function npSpiGetReqBuf
   \   00007F   12....       LCALL   ??npSpiGetReqBuf?relay
   \   000082   EA           MOV     A,R2
   \   000083   4B           ORL     A,R3
   \   000084   6003         JZ      ??znpEventLoop_13
    218              {
    219                MT_ProcessIncoming(pBuf);
   \   000086                ; Setup parameters for call to function MT_ProcessIncoming
   \   000086   12....       LCALL   ??MT_ProcessIncoming?relay
    220              }
    221          
    222              events ^= ZNP_SPI_RX_SREQ_EVENT;
   \                     ??znpEventLoop_13:
   \   000089   7420         MOV     A,#0x20
   \   00008B   80D2         SJMP    ??znpEventLoop_8
    223            }
    224          #endif
    225            else if (events & ZNP_UART_TX_READY_EVENT)
   \                     ??znpEventLoop_12:
   \   00008D   EF           MOV     A,R7
   \   00008E   5410         ANL     A,#0x10
   \   000090   7003         JNZ     $+5
   \   000092   02....       LJMP    ??znpEventLoop_14 & 0xFFFF
    226            {
    227              npUartTxReady();
   \   000095   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   000098   703B         JNZ     ??znpEventLoop_15
   \   00009A                ; Setup parameters for call to function osal_msg_dequeue
   \   00009A   7A..         MOV     R2,#npTxQueue & 0xff
   \   00009C   7B..         MOV     R3,#(npTxQueue >> 8) & 0xff
   \   00009E   12....       LCALL   ??osal_msg_dequeue?relay
   \   0000A1   8A..         MOV     ?V0 + 0,R2
   \   0000A3   8B..         MOV     ?V0 + 1,R3
   \   0000A5   A8..         MOV     R0,?V0 + 0
   \   0000A7   A9..         MOV     R1,?V0 + 1
   \   0000A9   90....       MOV     DPTR,#??npUartTxMsg
   \   0000AC   E8           MOV     A,R0
   \   0000AD   F0           MOVX    @DPTR,A
   \   0000AE   A3           INC     DPTR
   \   0000AF   E9           MOV     A,R1
   \   0000B0   F0           MOVX    @DPTR,A
   \   0000B1   90....       MOV     DPTR,#??pMsg
   \   0000B4   E8           MOV     A,R0
   \   0000B5   F0           MOVX    @DPTR,A
   \   0000B6   A3           INC     DPTR
   \   0000B7   E9           MOV     A,R1
   \   0000B8   F0           MOVX    @DPTR,A
   \   0000B9   E8           MOV     A,R0
   \   0000BA   49           ORL     A,R1
   \   0000BB   6018         JZ      ??znpEventLoop_15
   \   0000BD   E0           MOVX    A,@DPTR
   \   0000BE   F583         MOV     DPH,A
   \   0000C0   8882         MOV     DPL,R0
   \   0000C2   A3           INC     DPTR
   \   0000C3   E0           MOVX    A,@DPTR
   \   0000C4   2405         ADD     A,#0x5
   \   0000C6   F8           MOV     R0,A
   \   0000C7   E4           CLR     A
   \   0000C8   3400         ADDC    A,#0x0
   \   0000CA   F9           MOV     R1,A
   \   0000CB   90....       MOV     DPTR,#??npUartTxCnt
   \   0000CE   E8           MOV     A,R0
   \   0000CF   F0           MOVX    @DPTR,A
   \   0000D0   A3           INC     DPTR
   \   0000D1   E9           MOV     A,R1
   \   0000D2   F0           MOVX    @DPTR,A
   \   0000D3   8005         SJMP    ??znpEventLoop_16
   \                     ??znpEventLoop_15:
   \   0000D5   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   0000D8   604D         JZ      ??znpEventLoop_17
   \                     ??znpEventLoop_16:
   \   0000DA                ; Setup parameters for call to function HalUARTWrite
   \   0000DA   90....       MOV     DPTR,#??npUartTxCnt
   \   0000DD   E0           MOVX    A,@DPTR
   \   0000DE   FC           MOV     R4,A
   \   0000DF   A3           INC     DPTR
   \   0000E0   E0           MOVX    A,@DPTR
   \   0000E1   FD           MOV     R5,A
   \   0000E2   90....       MOV     DPTR,#??pMsg
   \   0000E5   E0           MOVX    A,@DPTR
   \   0000E6   FA           MOV     R2,A
   \   0000E7   A3           INC     DPTR
   \   0000E8   E0           MOVX    A,@DPTR
   \   0000E9   FB           MOV     R3,A
   \   0000EA   7900         MOV     R1,#0x0
   \   0000EC   12....       LCALL   ??HalUARTWrite?relay
   \   0000EF   90....       MOV     DPTR,#??npUartTxCnt
   \   0000F2   C3           CLR     C
   \   0000F3   E0           MOVX    A,@DPTR
   \   0000F4   9A           SUBB    A,R2
   \   0000F5   F0           MOVX    @DPTR,A
   \   0000F6   A3           INC     DPTR
   \   0000F7   E0           MOVX    A,@DPTR
   \   0000F8   9B           SUBB    A,R3
   \   0000F9   F0           MOVX    @DPTR,A
   \   0000FA   90....       MOV     DPTR,#??npUartTxCnt
   \   0000FD   12....       LCALL   ??Subroutine5_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   000100   7013         JNZ     ??znpEventLoop_18
   \   000102                ; Setup parameters for call to function osal_msg_deallocate
   \   000102   90....       MOV     DPTR,#??npUartTxMsg
   \   000105   E0           MOVX    A,@DPTR
   \   000106   FA           MOV     R2,A
   \   000107   A3           INC     DPTR
   \   000108   E0           MOVX    A,@DPTR
   \   000109   FB           MOV     R3,A
   \   00010A   12....       LCALL   ??osal_msg_deallocate?relay
   \   00010D   90....       MOV     DPTR,#??npUartTxMsg
   \   000110   E4           CLR     A
   \   000111   F0           MOVX    @DPTR,A
   \   000112   A3           INC     DPTR
   \   000113   8011         SJMP    ??znpEventLoop_19
   \                     ??znpEventLoop_18:
   \   000115   90....       MOV     DPTR,#??pMsg
   \   000118   E0           MOVX    A,@DPTR
   \   000119   2A           ADD     A,R2
   \   00011A   F8           MOV     R0,A
   \   00011B   A3           INC     DPTR
   \   00011C   E0           MOVX    A,@DPTR
   \   00011D   3B           ADDC    A,R3
   \   00011E   F9           MOV     R1,A
   \   00011F   90....       MOV     DPTR,#??pMsg
   \   000122   E8           MOV     A,R0
   \   000123   F0           MOVX    @DPTR,A
   \   000124   A3           INC     DPTR
   \   000125   E9           MOV     A,R1
   \                     ??znpEventLoop_19:
   \   000126   F0           MOVX    @DPTR,A
    228              events ^= ZNP_UART_TX_READY_EVENT;
   \                     ??znpEventLoop_17:
   \   000127   7410         MOV     A,#0x10
   \   000129   02....       LJMP    ??znpEventLoop_8 & 0xFFFF
    229            }
    230          #if defined MT_SYS_FUNC
    231            else if (events & MT_SYS_OSAL_EVENT_0)
   \                     ??znpEventLoop_14:
   \   00012C   EF           MOV     A,R7
   \   00012D   5408         ANL     A,#0x8
   \   00012F   600A         JZ      ??znpEventLoop_20
    232            {
    233              MT_SysOsalTimerExpired(0x00);
   \   000131                ; Setup parameters for call to function MT_SysOsalTimerExpired
   \   000131   7900         MOV     R1,#0x0
   \   000133   12....       LCALL   ??MT_SysOsalTimerExpired?relay
    234              events ^= MT_SYS_OSAL_EVENT_0;
   \   000136   7408         MOV     A,#0x8
   \   000138   02....       LJMP    ??znpEventLoop_8 & 0xFFFF
    235            }
    236            else if (events & MT_SYS_OSAL_EVENT_1)
   \                     ??znpEventLoop_20:
   \   00013B   EF           MOV     A,R7
   \   00013C   5404         ANL     A,#0x4
   \   00013E   600A         JZ      ??znpEventLoop_21
    237            {
    238              MT_SysOsalTimerExpired(0x01);
   \   000140                ; Setup parameters for call to function MT_SysOsalTimerExpired
   \   000140   7901         MOV     R1,#0x1
   \   000142   12....       LCALL   ??MT_SysOsalTimerExpired?relay
    239              events ^= MT_SYS_OSAL_EVENT_1;
   \   000145   7404         MOV     A,#0x4
   \   000147   02....       LJMP    ??znpEventLoop_8 & 0xFFFF
    240            }
    241            else if (events & MT_SYS_OSAL_EVENT_2)
   \                     ??znpEventLoop_21:
   \   00014A   EF           MOV     A,R7
   \   00014B   5402         ANL     A,#0x2
   \   00014D   600A         JZ      ??znpEventLoop_22
    242            {
    243              MT_SysOsalTimerExpired(0x02);
   \   00014F                ; Setup parameters for call to function MT_SysOsalTimerExpired
   \   00014F   7902         MOV     R1,#0x2
   \   000151   12....       LCALL   ??MT_SysOsalTimerExpired?relay
    244              events ^= MT_SYS_OSAL_EVENT_2;
   \   000154   7402         MOV     A,#0x2
   \   000156   02....       LJMP    ??znpEventLoop_8 & 0xFFFF
    245            }
    246            else if (events & MT_SYS_OSAL_EVENT_3)
   \                     ??znpEventLoop_22:
   \   000159   EF           MOV     A,R7
   \   00015A   5401         ANL     A,#0x1
   \   00015C   600A         JZ      ??znpEventLoop_23
    247            {
    248              MT_SysOsalTimerExpired(0x03);
   \   00015E                ; Setup parameters for call to function MT_SysOsalTimerExpired
   \   00015E   7903         MOV     R1,#0x3
   \   000160   12....       LCALL   ??MT_SysOsalTimerExpired?relay
    249              events ^= MT_SYS_OSAL_EVENT_3;
   \   000163   7401         MOV     A,#0x1
   \   000165   02....       LJMP    ??znpEventLoop_8 & 0xFFFF
    250            }
    251          #endif
    252          #if defined POWER_SAVING
    253            else if (events & ZNP_PWRMGR_CONSERVE_EVENT)
   \                     ??znpEventLoop_23:
   \   000168   EE           MOV     A,R6
   \   000169   5480         ANL     A,#0x80
   \   00016B   6010         JZ      ??znpEventLoop_24
    254            {
    255              (void)osal_pwrmgr_task_state(znpTaskId, PWRMGR_CONSERVE);
   \   00016D                ; Setup parameters for call to function osal_pwrmgr_task_state
   \   00016D   7A00         MOV     R2,#0x0
   \   00016F   90....       MOV     DPTR,#MT_TaskID
   \   000172   E0           MOVX    A,@DPTR
   \   000173   F9           MOV     R1,A
   \   000174   12....       LCALL   ??osal_pwrmgr_task_state?relay
    256              events ^= ZNP_PWRMGR_CONSERVE_EVENT;
   \   000177   7480         MOV     A,#-0x80
   \                     ??znpEventLoop_25:
   \   000179   6E           XRL     A,R6
   \   00017A   FE           MOV     R6,A
   \   00017B   801C         SJMP    ??znpEventLoop_9
    257            }
    258          #endif
    259            else if (events & ZNP_SECONDARY_INIT_EVENT)
   \                     ??znpEventLoop_24:
   \   00017D   EE           MOV     A,R6
   \   00017E   5410         ANL     A,#0x10
   \   000180   6007         JZ      ??znpEventLoop_26
    260            {
    261              npInit();
   \   000182                ; Setup parameters for call to function npInit
   \   000182   12....       LCALL   ??npInit?relay
    262              events ^= ZNP_SECONDARY_INIT_EVENT;
   \   000185   7410         MOV     A,#0x10
   \   000187   80F0         SJMP    ??znpEventLoop_25
    263            }
    264            else if (events & MT_AF_EXEC_EVT)
   \                     ??znpEventLoop_26:
   \   000189   EE           MOV     A,R6
   \   00018A   5408         ANL     A,#0x8
   \   00018C   6007         JZ      ??znpEventLoop_27
    265            {
    266              MT_AfExec();
   \   00018E                ; Setup parameters for call to function MT_AfExec
   \   00018E   12....       LCALL   ??MT_AfExec?relay
    267              events ^= MT_AF_EXEC_EVT;
   \   000191   7408         MOV     A,#0x8
   \   000193   80E4         SJMP    ??znpEventLoop_25
    268            }
    269            else
    270            {
    271              events = 0;  /* Discard unknown events. */
   \                     ??znpEventLoop_27:
   \   000195   7E00         MOV     R6,#0x0
   \   000197   7F00         MOV     R7,#0x0
    272            }
    273          
    274            return ( events );
   \                     ??znpEventLoop_9:
   \   000199   EE           MOV     A,R6
   \   00019A   FA           MOV     R2,A
   \   00019B   EF           MOV     A,R7
   \   00019C   FB           MOV     R3,A
   \   00019D   7F04         MOV     R7,#0x4
   \   00019F   02....       LJMP    ?BANKED_LEAVE_XDATA
    275          }
    276          
    277          /**************************************************************************************************
    278           * @fn          MT_TransportAlloc
    279           *
    280           * @brief       This function is the definition of the physical transport API for allocation a msg.
    281           *
    282           * input parameters
    283           *
    284           * @param cmd0 - The RPC command byte 0.
    285           * @param len - The RPC data length.
    286           *
    287           * output parameters
    288           *
    289           * @param uint8 * - Pointer to the buffer to use build and send the RPC message.
    290           *
    291           * @return      None.
    292           **************************************************************************************************
    293           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    294          uint8 *MT_TransportAlloc(uint8 cmd0, uint8 len)
   \                     MT_TransportAlloc:
    295          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   \   000007   EA           MOV     A,R2
   \   000008   FF           MOV     R7,A
    296          #if !defined CC2531ZNP
    297            if (ZNP_CFG1_UART == znpCfg1)
   \   000009   90....       MOV     DPTR,#znpCfg1
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   7024         JNZ     ??MT_TransportAlloc_0
    298          #endif
    299            {
    300              return npMtUartAlloc(cmd0, len);
   \   00000F                ; Setup parameters for call to function osal_msg_allocate
   \   00000F   EA           MOV     A,R2
   \   000010   2405         ADD     A,#0x5
   \   000012   FA           MOV     R2,A
   \   000013   E4           CLR     A
   \   000014   3400         ADDC    A,#0x0
   \   000016   FB           MOV     R3,A
   \   000017   12....       LCALL   ??osal_msg_allocate?relay
   \   00001A   8A82         MOV     DPL,R2
   \   00001C   8B83         MOV     DPH,R3
   \   00001E   E582         MOV     A,DPL
   \   000020   4583         ORL     A,DPH
   \   000022   6003         JZ      ??MT_TransportAlloc_1
   \   000024   A3           INC     DPTR
   \   000025   8006         SJMP    ??MT_TransportAlloc_2
   \                     ??MT_TransportAlloc_1:
   \   000027   758200       MOV     DPL,#0x0
   \   00002A   758300       MOV     DPH,#0x0
    301            }
   \                     ??MT_TransportAlloc_2:
   \   00002D   AA82         MOV     R2,DPL
   \   00002F   AB83         MOV     R3,DPH
   \   000031   8013         SJMP    ??MT_TransportAlloc_3
    302          #if !defined CC2531ZNP
    303            else
    304            {
    305              return npMtSpiAlloc(cmd0, len);
   \                     ??MT_TransportAlloc_0:
   \   000033   74E0         MOV     A,#-0x20
   \   000035   5E           ANL     A,R6
   \   000036   6460         XRL     A,#0x60
   \   000038   7007         JNZ     ??MT_TransportAlloc_4
   \   00003A                ; Setup parameters for call to function npSpiSRspAlloc
   \   00003A   EF           MOV     A,R7
   \   00003B   F9           MOV     R1,A
   \   00003C   12....       LCALL   ??npSpiSRspAlloc?relay
   \   00003F   8005         SJMP    ??MT_TransportAlloc_3
   \                     ??MT_TransportAlloc_4:
   \   000041                ; Setup parameters for call to function npSpiAReqAlloc
   \   000041   EF           MOV     A,R7
   \   000042   F9           MOV     R1,A
   \   000043   12....       LCALL   ??npSpiAReqAlloc?relay
    306            }
   \                     ??MT_TransportAlloc_3:
   \   000046                REQUIRE ?Subroutine1
   \   000046                ; // Fall through to label ?Subroutine1
    307          #endif
    308          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7F02         MOV     R7,#0x2
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    309          
    310          /**************************************************************************************************
    311           * @fn          MT_TransportSend
    312           *
    313           * @brief       This function is the definition of the physical transport API for sending a message.
    314           *
    315           * input parameters
    316           *
    317           * @param pBuf - Pointer to the buffer created with MT_TransportAlloc.
    318           *
    319           * output parameters
    320           *
    321           * None.
    322           *
    323           * @return      None.
    324           **************************************************************************************************
    325           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    326          void MT_TransportSend(uint8 *pBuf)
   \                     MT_TransportSend:
    327          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    328          #if !defined CC2531ZNP
    329            if (ZNP_CFG1_UART == znpCfg1)
   \   000009   90....       MOV     DPTR,#znpCfg1
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   8E82         MOV     DPL,R6
   \   00000F   8F83         MOV     DPH,R7
   \   000011   703B         JNZ     ??MT_TransportSend_0
    330          #endif
    331            {
    332              npMtUartSend(pBuf);
   \   000013   E0           MOVX    A,@DPTR
   \   000014   2403         ADD     A,#0x3
   \   000016   F5..         MOV     ?V0 + 0,A
   \   000018                ; Setup parameters for call to function MT_UartCalcFCS
   \   000018   F9           MOV     R1,A
   \   000019   12....       LCALL   ??MT_UartCalcFCS?relay
   \   00001C   EE           MOV     A,R6
   \   00001D   25..         ADD     A,?V0 + 0
   \   00001F   F582         MOV     DPL,A
   \   000021   EF           MOV     A,R7
   \   000022   3400         ADDC    A,#0x0
   \   000024   F583         MOV     DPH,A
   \   000026   E9           MOV     A,R1
   \   000027   F0           MOVX    @DPTR,A
   \   000028   EE           MOV     A,R6
   \   000029   24FF         ADD     A,#-0x1
   \   00002B   F582         MOV     DPL,A
   \   00002D   EF           MOV     A,R7
   \   00002E   34FF         ADDC    A,#-0x1
   \   000030   F583         MOV     DPH,A
   \   000032   74FE         MOV     A,#-0x2
   \   000034   F0           MOVX    @DPTR,A
   \   000035                ; Setup parameters for call to function osal_msg_enqueue
   \   000035   AC82         MOV     R4,DPL
   \   000037   AD83         MOV     R5,DPH
   \   000039   7A..         MOV     R2,#npTxQueue & 0xff
   \   00003B   7B..         MOV     R3,#(npTxQueue >> 8) & 0xff
   \   00003D   12....       LCALL   ??osal_msg_enqueue?relay
   \   000040                ; Setup parameters for call to function osal_set_event
   \   000040   7A00         MOV     R2,#0x0
   \   000042   7B10         MOV     R3,#0x10
   \   000044   90....       MOV     DPTR,#MT_TaskID
   \   000047   E0           MOVX    A,@DPTR
   \   000048   F9           MOV     R1,A
   \   000049   12....       LCALL   ??osal_set_event?relay
    333            }
   \   00004C   801B         SJMP    ??MT_TransportSend_1
    334          #if !defined CC2531ZNP
    335            else
    336            {
    337              npMtSpiSend(pBuf);
   \                     ??MT_TransportSend_0:
   \   00004E   A3           INC     DPTR
   \   00004F   E0           MOVX    A,@DPTR
   \   000050   54E0         ANL     A,#0xe0
   \   000052   6460         XRL     A,#0x60
   \   000054   7005         JNZ     ??MT_TransportSend_2
   \   000056                ; Setup parameters for call to function npSpiSRspReady
   \   000056   12....       LCALL   ??npSpiSRspReady?relay
   \   000059   800E         SJMP    ??MT_TransportSend_1
   \                     ??MT_TransportSend_2:
   \   00005B                ; Setup parameters for call to function osal_msg_enqueue
   \   00005B   EE           MOV     A,R6
   \   00005C   FC           MOV     R4,A
   \   00005D   EF           MOV     A,R7
   \   00005E   FD           MOV     R5,A
   \   00005F   7A..         MOV     R2,#npTxQueue & 0xff
   \   000061   7B..         MOV     R3,#(npTxQueue >> 8) & 0xff
   \   000063   12....       LCALL   ??osal_msg_enqueue?relay
   \   000066                ; Setup parameters for call to function npSpiAReqReady
   \   000066   12....       LCALL   ??npSpiAReqReady?relay
    338            }
    339          #endif
    340          }
   \                     ??MT_TransportSend_1:
   \   000069   80..         SJMP    ?Subroutine1
    341          
    342          /**************************************************************************************************
    343           * @fn         npInit
    344           *
    345           * @brief      This function is the secondary initialization that resolves conflicts during
    346           *             osalInitTasks(). For example, since ZNP is the highest priority task, and
    347           *             specifically because the ZNP task is initialized before the ZDApp task, if znpInit()
    348           *             registers anything with ZDO_RegisterForZdoCB(), it is wiped out when ZDApp task
    349           *             initialization invokes ZDApp_InitZdoCBFunc().
    350           *             There may be other existing or future such races, so try to do all possible
    351           *             NP initialization here vice in znpInit().
    352           *
    353           * input parameters
    354           *
    355           * None.
    356           *
    357           * output parameters
    358           *
    359           * None.
    360           *
    361           * @return      None.
    362           **************************************************************************************************
    363           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    364          static void npInit(void)
   \                     npInit:
    365          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 29
   \   000005   74E3         MOV     A,#-0x1d
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    366            if (ZNP_CFG1_UART == znpCfg1)
   \   00000A   90....       MOV     DPTR,#znpCfg1
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   7064         JNZ     ??npInit_0
    367            {
    368              halUARTCfg_t uartConfig;
    369          
    370              uartConfig.configured           = TRUE;
   \   000010   85..82       MOV     DPL,?XSP + 0
   \   000013   85..83       MOV     DPH,?XSP + 1
   \   000016   7401         MOV     A,#0x1
   \   000018   F0           MOVX    @DPTR,A
    371              uartConfig.baudRate             = ZNP_UART_BAUD;
   \   000019   12....       LCALL   ?XSTACK_DISP0_8
   \   00001C   7404         MOV     A,#0x4
   \   00001E   F0           MOVX    @DPTR,A
    372              uartConfig.flowControl          = TRUE;
   \   00001F   7402         MOV     A,#0x2
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   7401         MOV     A,#0x1
   \   000026   F0           MOVX    @DPTR,A
    373              uartConfig.flowControlThreshold = HAL_UART_FLOW_THRESHOLD;
   \   000027   7403         MOV     A,#0x3
   \   000029   12....       LCALL   ?XSTACK_DISP0_8
   \   00002C   E4           CLR     A
   \   00002D   F0           MOVX    @DPTR,A
   \   00002E   A3           INC     DPTR
   \   00002F   F0           MOVX    @DPTR,A
    374              uartConfig.rx.maxBufSize        = HAL_UART_RX_BUF_SIZE;
   \   000030   740A         MOV     A,#0xa
   \   000032   12....       LCALL   ?XSTACK_DISP0_8
   \   000035   E4           CLR     A
   \   000036   F0           MOVX    @DPTR,A
   \   000037   A3           INC     DPTR
   \   000038   F0           MOVX    @DPTR,A
    375              uartConfig.tx.maxBufSize        = HAL_UART_TX_BUF_SIZE;
   \   000039   7412         MOV     A,#0x12
   \   00003B   12....       LCALL   ?XSTACK_DISP0_8
   \   00003E   E4           CLR     A
   \   00003F   F0           MOVX    @DPTR,A
   \   000040   A3           INC     DPTR
   \   000041   F0           MOVX    @DPTR,A
    376              uartConfig.idleTimeout          = HAL_UART_IDLE_TIMEOUT;
   \   000042   7405         MOV     A,#0x5
   \   000044   12....       LCALL   ?XSTACK_DISP0_8
   \   000047   E4           CLR     A
   \   000048   F0           MOVX    @DPTR,A
    377              uartConfig.intEnable            = TRUE;
   \   000049   7416         MOV     A,#0x16
   \   00004B   12....       LCALL   ?XSTACK_DISP0_8
   \   00004E   7401         MOV     A,#0x1
   \   000050   F0           MOVX    @DPTR,A
    378              uartConfig.callBackFunc         = npUartCback;
   \   000051   741B         MOV     A,#0x1b
   \   000053   12....       LCALL   ?XSTACK_DISP0_8
   \   000056   74..         MOV     A,#??npUartCback?relay & 0xff
   \   000058   F0           MOVX    @DPTR,A
   \   000059   A3           INC     DPTR
   \   00005A   74..         MOV     A,#(??npUartCback?relay >> 8) & 0xff
   \   00005C   F0           MOVX    @DPTR,A
    379              HalUARTOpen(HAL_UART_PORT, &uartConfig);
   \   00005D                ; Setup parameters for call to function HalUARTOpen
   \   00005D   85..82       MOV     DPL,?XSP + 0
   \   000060   85..83       MOV     DPH,?XSP + 1
   \   000063   AA82         MOV     R2,DPL
   \   000065   AB83         MOV     R3,DPH
   \   000067   7900         MOV     R1,#0x0
   \   000069   12....       LCALL   ??HalUARTOpen?relay
    380              MT_UartRegisterTaskID(znpTaskId);
   \   00006C                ; Setup parameters for call to function MT_UartRegisterTaskID
   \   00006C   90....       MOV     DPTR,#MT_TaskID
   \   00006F   E0           MOVX    A,@DPTR
   \   000070   F9           MOV     R1,A
   \   000071   12....       LCALL   ??MT_UartRegisterTaskID?relay
    381            }
    382            else
    383            {
    384              //npSpiInit() is called by hal_spi.c: HalSpiInit().
    385            }
    386          
    387            npInitNV();
   \                     ??npInit_0:
   \   000074                ; Setup parameters for call to function osal_nv_item_init
   \   000074   E4           CLR     A
   \   000075   F5..         MOV     ?V0 + 0,A
   \   000077   F5..         MOV     ?V0 + 1,A
   \   000079   78..         MOV     R0,#?V0 + 0
   \   00007B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00007E   7C02         MOV     R4,#0x2
   \   000080   7D00         MOV     R5,#0x0
   \   000082   7A01         MOV     R2,#0x1
   \   000084   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   000087   12....       LCALL   ?DEALLOC_XSTACK8
   \   00008A                ; Setup parameters for call to function osal_nv_item_init
   \   00008A   78..         MOV     R0,#?V0 + 0
   \   00008C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00008F   7C02         MOV     R4,#0x2
   \   000091   7D00         MOV     R5,#0x0
   \   000093   7A02         MOV     R2,#0x2
   \   000095   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   000098   12....       LCALL   ?DEALLOC_XSTACK8
   \   00009B                ; Setup parameters for call to function osal_nv_item_init
   \   00009B   78..         MOV     R0,#?V0 + 0
   \   00009D   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000A0   7C02         MOV     R4,#0x2
   \   0000A2   7D00         MOV     R5,#0x0
   \   0000A4   7A03         MOV     R2,#0x3
   \   0000A6   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   0000A9   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000AC                ; Setup parameters for call to function osal_nv_item_init
   \   0000AC   78..         MOV     R0,#?V0 + 0
   \   0000AE   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000B1   7C02         MOV     R4,#0x2
   \   0000B3   7D00         MOV     R5,#0x0
   \   0000B5   7A04         MOV     R2,#0x4
   \   0000B7   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   0000BA   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000BD                ; Setup parameters for call to function osal_nv_item_init
   \   0000BD   78..         MOV     R0,#?V0 + 0
   \   0000BF   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000C2   7C10         MOV     R4,#0x10
   \   0000C4   7D00         MOV     R5,#0x0
   \   0000C6   7A05         MOV     R2,#0x5
   \   0000C8   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   0000CB   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000CE                ; Setup parameters for call to function osal_nv_item_init
   \   0000CE   78..         MOV     R0,#?V0 + 0
   \   0000D0   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000D3   7C10         MOV     R4,#0x10
   \   0000D5   7D00         MOV     R5,#0x0
   \   0000D7   7A06         MOV     R2,#0x6
   \   0000D9   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   0000DC   12....       LCALL   ?DEALLOC_XSTACK8
    388            MT_Init();
   \   0000DF                ; Setup parameters for call to function MT_Init
   \   0000DF   12....       LCALL   ??MT_Init?relay
    389          #if defined TC_LINKKEY_JOIN
    390            zcl_TaskID = znpTaskId;
    391          #endif
    392          #if LQI_ADJUST
    393            ZMacLqiAdjustMode(LQI_ADJ_MODE1);
    394          #endif
    395          #if defined CC2531ZNP
    396            (void)osal_pwrmgr_task_state(znpTaskId, PWRMGR_HOLD);
    397          #endif
    398          }
   \   0000E2   741D         MOV     A,#0x1d
   \   0000E4   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000E7   02....       LJMP    ?Subroutine1 & 0xFFFF
    399          
    400          /**************************************************************************************************
    401           * @fn         npInitNV
    402           *
    403           * @brief
    404           *
    405           * input parameters
    406           *
    407           * None.
    408           *
    409           * output parameters
    410           *
    411           * None.
    412           *
    413           * @return      None.
    414           **************************************************************************************************
    415           */
    416          static void npInitNV(void)
    417          {
    418            /* 4 x 2 bytes ZNP_NV_APP_ITEM_X */
    419            osal_nv_item_init(ZNP_NV_APP_ITEM_1, 2, NULL);
    420            osal_nv_item_init(ZNP_NV_APP_ITEM_2, 2, NULL);
    421            osal_nv_item_init(ZNP_NV_APP_ITEM_3, 2, NULL);
    422            osal_nv_item_init(ZNP_NV_APP_ITEM_4, 2, NULL);
    423          
    424            /* 2 x 16 bytes ZNP_NV_APP_ITEM_X */
    425            osal_nv_item_init(ZNP_NV_APP_ITEM_5, 16, NULL);
    426            osal_nv_item_init(ZNP_NV_APP_ITEM_6, 16, NULL);
    427          }
    428          
    429          /**************************************************************************************************
    430           * @fn          npUartCback
    431           *
    432           * @brief       This function is the UART callback processor.
    433           *
    434           * input parameters
    435           *
    436           * @param port - The port being used for UART.
    437           * @param event - The reason for the callback.
    438           *
    439           * output parameters
    440           *
    441           * None.
    442           *
    443           * @return      None.
    444           **************************************************************************************************
    445           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    446          static void npUartCback(uint8 port, uint8 event)
   \                     npUartCback:
    447          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
    448            switch (event) {
   \   000006   14           DEC     A
   \   000007   600D         JZ      ??npUartCback_0
   \   000009   14           DEC     A
   \   00000A   600A         JZ      ??npUartCback_0
   \   00000C   24FE         ADD     A,#-0x2
   \   00000E   6006         JZ      ??npUartCback_0
   \   000010   24F4         ADD     A,#-0xc
   \   000012   600C         JZ      ??npUartCback_1
   \   000014   8016         SJMP    ??npUartCback_2
    449            case HAL_UART_RX_FULL:
    450            case HAL_UART_RX_ABOUT_FULL:
    451            case HAL_UART_RX_TIMEOUT:
    452              MT_UartProcessZToolData(port, znpTaskId);
   \                     ??npUartCback_0:
   \   000016                ; Setup parameters for call to function MT_UartProcessZToolData
   \   000016   90....       MOV     DPTR,#MT_TaskID
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   FA           MOV     R2,A
   \   00001B   12....       LCALL   ??MT_UartProcessZToolData?relay
    453              break;
   \   00001E   800C         SJMP    ??npUartCback_2
    454          
    455            case HAL_UART_TX_EMPTY:
    456              osal_set_event(znpTaskId, ZNP_UART_TX_READY_EVENT);
   \                     ??npUartCback_1:
   \   000020                ; Setup parameters for call to function osal_set_event
   \   000020   7A00         MOV     R2,#0x0
   \   000022   7B10         MOV     R3,#0x10
   \   000024   90....       MOV     DPTR,#MT_TaskID
   \   000027   E0           MOVX    A,@DPTR
   \   000028   F9           MOV     R1,A
   \   000029   12....       LCALL   ??osal_set_event?relay
    457              break;
    458          
    459            default:
    460              break;
    461            }
    462          }
   \                     ??npUartCback_2:
   \   00002C   02....       LJMP    ?Subroutine0 & 0xFFFF
    463          
    464          /**************************************************************************************************
    465           * @fn          npUartTxReady
    466           *
    467           * @brief       This function gets and writes the next chunk of data to the UART.
    468           *
    469           * input parameters
    470           *
    471           * None.
    472           *
    473           * output parameters
    474           *
    475           * None.
    476           *
    477           * @return      None.
    478           **************************************************************************************************
    479           */
    480          static void npUartTxReady(void)
    481          {

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    482            static uint16 npUartTxCnt = 0;
   \                     ??npUartTxCnt:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    483            static uint8 *npUartTxMsg = NULL;
   \                     ??npUartTxMsg:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    484            static uint8 *pMsg = NULL;
   \                     ??pMsg:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    485          
    486            if (!npUartTxMsg)
    487            {
    488              if ((pMsg = npUartTxMsg = osal_msg_dequeue(&npTxQueue)))
    489              {
    490                /* | SOP | Data Length | CMD |  DATA   | FSC |
    491                 * |  1  |     1       |  2  | as dLen |  1  |
    492                 */
    493                npUartTxCnt = pMsg[1] + MT_UART_FRAME_OVHD + MT_RPC_FRAME_HDR_SZ;
    494              }
    495            }
    496          
    497            if (npUartTxMsg)
    498            {
    499              uint16 len = HalUARTWrite(HAL_UART_PORT, pMsg, npUartTxCnt);
    500              npUartTxCnt -= len;
    501          
    502              if (npUartTxCnt == 0)
    503              {
    504                osal_msg_deallocate(npUartTxMsg);
    505                npUartTxMsg = NULL;
    506              }
    507              else
    508              {
    509                pMsg += len;
    510              }
    511            }
    512          }
    513          
    514          /**************************************************************************************************
    515           * @fn          npMtUartAlloc
    516           *
    517           * @brief       This function allocates a buffer for Txing on UART.
    518           *
    519           * input parameters
    520           *
    521           * @param cmd0 - The first byte of the MT command id containing the command type and subsystem.
    522           * @param len - Data length required.
    523           *
    524           * output parameters
    525           *
    526           * None.
    527           *
    528           * @return      Pointer to the buffer obtained; possibly NULL if an allocation failed.
    529           **************************************************************************************************
    530           */
    531          static uint8* npMtUartAlloc(uint8 cmd0, uint8 len)
    532          {
    533            uint8 *p;
    534          
    535            if ((p = osal_msg_allocate(len + MT_RPC_FRAME_HDR_SZ + MT_UART_FRAME_OVHD)) != NULL)
    536            {
    537              return p + 1;
    538            }
    539          
    540            return NULL;
    541          }
    542          
    543          /**************************************************************************************************
    544           * @fn          npMtUartSend
    545           *
    546           * @brief       This function transmits or enqueues the buffer for transmitting on UART.
    547           *
    548           * input parameters
    549           *
    550           * @param pBuf - Pointer to the buffer to transmit on the UART.
    551           *
    552           * output parameters
    553           *
    554           * None.
    555           *
    556           * @return      None.
    557           **************************************************************************************************
    558           */
    559          static void npMtUartSend(uint8 *pBuf)
    560          {
    561            uint8 len = pBuf[0] + MT_RPC_FRAME_HDR_SZ;
    562          
    563            pBuf[len] = MT_UartCalcFCS(pBuf, len);
    564            pBuf--;
    565            pBuf[0] = MT_UART_SOF;
    566          
    567            osal_msg_enqueue(&npTxQueue, pBuf);
    568            osal_set_event(znpTaskId, ZNP_UART_TX_READY_EVENT);
    569          }
    570          
    571          #if !defined CC2531ZNP
    572          /**************************************************************************************************
    573           * @fn          npMtSpiAlloc
    574           *
    575           * @brief       This function gets or allocates a buffer for Txing on SPI.
    576           *
    577           * input parameters
    578           *
    579           * @param cmd0 - The first byte of the MT command id containing the command type and subsystem.
    580           * @param len - Data length required.
    581           *
    582           * output parameters
    583           *
    584           * None.
    585           *
    586           * @return      Pointer to the buffer obtained; possibly NULL if an allocation failed.
    587           **************************************************************************************************
    588           */
    589          static uint8* npMtSpiAlloc(uint8 cmd0, uint8 len)
    590          {
    591            if ((cmd0 & MT_RPC_CMD_TYPE_MASK) == MT_RPC_CMD_SRSP)
    592            {
    593              return npSpiSRspAlloc(len);
    594            }
    595            else
    596            {
    597              return npSpiAReqAlloc(len);
    598            }
    599          }
    600          
    601          /**************************************************************************************************
    602           * @fn          npMtSpiSend
    603           *
    604           * @brief       This function transmits or enqueues the buffer for transmitting on SPI.
    605           *
    606           * input parameters
    607           *
    608           * @param pBuf - Pointer to the buffer to transmit on the SPI.
    609           *
    610           * output parameters
    611           *
    612           * None.
    613           *
    614           * @return      None.
    615           **************************************************************************************************
    616           */
    617          static void npMtSpiSend(uint8 *pBuf)
    618          {
    619            if ((pBuf[1] & MT_RPC_CMD_TYPE_MASK) == MT_RPC_CMD_SRSP)
    620            {
    621              npSpiSRspReady(pBuf);
    622            }
    623            else
    624            {
    625              osal_msg_enqueue(&npTxQueue, pBuf);
    626              npSpiAReqReady();
    627            }
    628          }
    629          
    630          /**************************************************************************************************
    631           * @fn          npSpiPollCallback
    632           *
    633           * @brief       This function is called by the SPI driver when a POLL frame is received.
    634           *
    635           * input parameters
    636           *
    637           * None.
    638           *
    639           * output parameters
    640           *
    641           * None.
    642           *
    643           * @return      A pointer to an OSAL message buffer containing the next AREQ frame to transmit,
    644           *              if any; NULL otherwise.
    645           **************************************************************************************************
    646           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    647          uint8* npSpiPollCallback(void)
   \                     npSpiPollCallback:
    648          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    649            return osal_msg_dequeue(&npTxQueue);
   \   000004                ; Setup parameters for call to function osal_msg_dequeue
   \   000004   7A..         MOV     R2,#npTxQueue & 0xff
   \   000006   7B..         MOV     R3,#(npTxQueue >> 8) & 0xff
   \   000008   12....       LCALL   ??osal_msg_dequeue?relay
   \   00000B                REQUIRE ?Subroutine2
   \   00000B                ; // Fall through to label ?Subroutine2
    650          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    651          
    652          /**************************************************************************************************
    653           * @fn          npSpiReadyCallback
    654           *
    655           * @brief       This function is called by the SPI driver to check if any data is ready to send.
    656           *
    657           * input parameters
    658           *
    659           * None.
    660           *
    661           * output parameters
    662           *
    663           * None.
    664           *
    665           * @return      TRUE if data is ready to send; FALSE otherwise.
    666           **************************************************************************************************
    667           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    668          bool npSpiReadyCallback(void)
   \                     npSpiReadyCallback:
    669          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    670            return !OSAL_MSG_Q_EMPTY(&npTxQueue);
   \   000004   90....       MOV     DPTR,#npTxQueue
   \   000007   12....       LCALL   ??Subroutine5_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   00000A   6004         JZ      ??npSpiReadyCallback_0
   \   00000C   7901         MOV     R1,#0x1
   \   00000E   8002         SJMP    ??npSpiReadyCallback_1
   \                     ??npSpiReadyCallback_0:
   \   000010   7900         MOV     R1,#0x0
   \                     ??npSpiReadyCallback_1:
   \   000012   80..         SJMP    ?Subroutine2
    671          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine5_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F8           MOV     R0,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   E8           MOV     A,R0
   \   000006   49           ORL     A,R1
   \   000007   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   7B0F         MOV     R3,#0xf
   \   000002   12....       LCALL   ??osal_nv_item_init?relay
   \   000005   7402         MOV     A,#0x2
   \   000007   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   90....       MOV     DPTR,#??npUartTxMsg
   \   000003                REQUIRE ??Subroutine5_0
   \   000003                ; // Fall through to label ??Subroutine5_0

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??znpInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    znpInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??znpEventLoop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    znpEventLoop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_TransportAlloc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_TransportAlloc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_TransportSend?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_TransportSend

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??npInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    npInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??npUartCback?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    npUartCback

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??npSpiPollCallback?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    npSpiPollCallback

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??npSpiReadyCallback?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    npSpiReadyCallback
    672          #endif
    673          
    674          /**************************************************************************************************
    675          */

   Maximum stack usage in bytes:

     Function                     ISTACK PSTACK XSTACK
     --------                     ------ ------ ------
     MT_TransportAlloc                0      0     10
       -> osal_msg_allocate           0      0     20
       -> npSpiSRspAlloc              0      0     20
       -> npSpiAReqAlloc              0      0     20
     MT_TransportSend                 1      0     10
       -> MT_UartCalcFCS              0      0     20
       -> osal_msg_enqueue            0      0     20
       -> osal_set_event              0      0     20
       -> npSpiSRspReady              0      0     20
       -> osal_msg_enqueue            0      0     20
       -> npSpiAReqReady              0      0     20
     npInit                           0      0     53
       -> HalUARTOpen                 0      0     78
       -> MT_UartRegisterTaskID       0      0     78
       -> osal_nv_item_init           0      0     82
       -> osal_nv_item_init           0      0     82
       -> osal_nv_item_init           0      0     82
       -> osal_nv_item_init           0      0     82
       -> osal_nv_item_init           0      0     82
       -> osal_nv_item_init           0      0     82
       -> MT_Init                     0      0     78
     npSpiPollCallback                2      0      0
       -> osal_msg_dequeue            4      0      0
     npSpiReadyCallback               2      0      0
     npUartCback                      0      0      9
       -> MT_UartProcessZToolData     0      0     18
       -> osal_set_event              0      0     18
     znpEventLoop                     0      0     12
       -> osal_msg_receive            0      0     24
       -> MT_ProcessIncoming          0      0     24
       -> MT_AfIncomingMsg            0      0     24
       -> MT_ZdoStateChangeCB         0      0     24
       -> MT_ZdoSendMsgCB             0      0     24
       -> MT_AfDataConfirm            0      0     24
       -> osal_msg_deallocate         0      0     24
       -> npSpiGetReqBuf              0      0     24
       -> MT_ProcessIncoming          0      0     24
       -> npSpiAReqComplete           0      0     24
       -> npSpiGetReqBuf              0      0     24
       -> MT_ProcessIncoming          0      0     24
       -> osal_msg_dequeue            0      0     24
       -> HalUARTWrite                0      0     24
       -> osal_msg_deallocate         0      0     24
       -> MT_SysOsalTimerExpired      0      0     24
       -> MT_SysOsalTimerExpired      0      0     24
       -> MT_SysOsalTimerExpired      0      0     24
       -> MT_SysOsalTimerExpired      0      0     24
       -> osal_pwrmgr_task_state      0      0     24
       -> npInit                      0      0     24
       -> MT_AfExec                   0      0     24
     znpInit                          0      0      9
       -> osal_set_event              0      0     18


   Segment part sizes:

     Function/Label             Bytes
     --------------             -----
     npTxQueue                     2
     znpCfg1                       1
     znpCfg0                       1
     znpInit                      17
     ?Subroutine0                  5
     znpEventLoop                418
     MT_TransportAlloc            70
     ?Subroutine1                  5
     MT_TransportSend            107
     npInit                      234
     npUartCback                  47
     npUartTxCnt                   2
     npUartTxMsg                   2
     pMsg                          2
     npSpiPollCallback            11
     ?Subroutine2                  7
     npSpiReadyCallback           20
     ??Subroutine5_0               8
     ?Subroutine4                  8
     ?Subroutine3                  3
     ??znpInit?relay               6
     ??znpEventLoop?relay          6
     ??MT_TransportAlloc?relay     6
     ??MT_TransportSend?relay      6
     ??npInit?relay                6
     ??npUartCback?relay           6
     ??npSpiPollCallback?relay     6
     ??npSpiReadyCallback?relay    6

 
 960 bytes in segment BANKED_CODE
  48 bytes in segment BANK_RELAYS
  10 bytes in segment XDATA_Z
 
 1 008 bytes of CODE  memory
    10 bytes of XDATA memory

Errors: none
Warnings: none
